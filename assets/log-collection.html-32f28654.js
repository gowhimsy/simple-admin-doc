import{_ as t}from"./kibana-dac8c721.js";import{_ as l}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o,c,a,b as n,d as s,e as r}from"./app-950724a6.js";const p={},u=a("h1",{id:"log-collecting",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#log-collecting","aria-hidden":"true"},"#"),n(" Log Collecting")],-1),d=a("blockquote",null,[a("p",null,"We use EFK to do the log collecting.")],-1),k=a("ul",null,[a("li",null,"Elasticsearch"),a("li",null,"Filebeat"),a("li",null,"Kibana")],-1),m=a("blockquote",null,[a("p",null,"Installation")],-1),v={href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html",target:"_blank",rel:"noopener noreferrer"},b={href:"https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation-configuration.html",target:"_blank",rel:"noopener noreferrer"},h={href:"https://www.elastic.co/guide/en/kibana/current/docker.html",target:"_blank",rel:"noopener noreferrer"},f=r(`<h2 id="install-step-in-test-env" tabindex="-1"><a class="header-anchor" href="#install-step-in-test-env" aria-hidden="true">#</a> Install step in test env</h2><h3 id="docker" tabindex="-1"><a class="header-anchor" href="#docker" aria-hidden="true">#</a> Docker</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># es</span>
<span class="token function">docker</span> run <span class="token parameter variable">--name</span> es01 <span class="token parameter variable">--net</span> elastic <span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token parameter variable">-e</span> <span class="token assign-left variable">ES_JAVA_OPTS</span><span class="token operator">=</span><span class="token string">&quot;-Xms1g -Xmx1g&quot;</span> <span class="token parameter variable">-m</span> 3g <span class="token parameter variable">-it</span> docker.elastic.co/elasticsearch/elasticsearch:8.4.3

<span class="token comment"># kibana</span>
<span class="token function">docker</span> run <span class="token parameter variable">--name</span> kib-01 <span class="token parameter variable">--net</span> elastic <span class="token parameter variable">-p</span> <span class="token number">5601</span>:5601 docker.elastic.co/kibana/kibana:8.4.3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="filebeat" tabindex="-1"><a class="header-anchor" href="#filebeat" aria-hidden="true">#</a> Filebeat</h3><p>Modify filebeat-deploy.yaml， which is in simple-admin-core/deploy/k8s/log-collection/filebeat/</p><blockquote><p>You can add other log path for other api service， default only having core logs.</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code> <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> log
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> /home/data/logs/core/<span class="token important">*/*.log</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="configure-environment-variables" tabindex="-1"><a class="header-anchor" href="#configure-environment-variables" aria-hidden="true">#</a> Configure environment variables</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ELASTICSEARCH_HOST   
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;192.168.50.216&quot;</span>  <span class="token comment"># ES address</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ELASTICSEARCH_PORT
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;9200&quot;</span>  <span class="token comment"># ES port</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ELASTICSEARCH_USERNAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> elastic <span class="token comment"># ES username</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ELASTICSEARCH_PASSWORD
              <span class="token key atrule">value</span><span class="token punctuation">:</span> UQ==CXXjw47bK_I13<span class="token important">*f1</span> <span class="token comment"># password</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ELASTICSEARCH_CA_FINGERPRINT
              <span class="token key atrule">value</span><span class="token punctuation">:</span> 8d6aed6bba745f2f0aaa46f628e3124c82ae6727c1f5e207e3d821ffeefb5e5e <span class="token comment"># trust CA&#39;s fingerprint</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ELASTIC_CLOUD_ID 
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token comment"># cloud ID， optional</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ELASTIC_CLOUD_AUTH 
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token comment"># cloud Token， optional</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="install-filebeat-via-script" tabindex="-1"><a class="header-anchor" href="#install-filebeat-via-script" aria-hidden="true">#</a> Install filebeat via script</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Enter simple-admin-core/deploy/k8s/log-collection/filebeat</span>
kubectl apply <span class="token parameter variable">-f</span> filebeat-deploy.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="preview-in-kibana" tabindex="-1"><a class="header-anchor" href="#preview-in-kibana" aria-hidden="true">#</a> Preview in kibana</h3><figure><img src="`+t+'" alt="Pic" tabindex="0" loading="lazy"><figcaption>Pic</figcaption></figure>',13);function g(_,y){const e=i("ExternalLinkIcon");return o(),c("div",null,[u,d,k,m,a("ul",null,[a("li",null,[a("a",v,[n("Elasticsearch"),s(e)])]),a("li",null,[a("a",b,[n("Filebeat"),s(e)])]),a("li",null,[a("a",h,[n("Kibana"),s(e)])])]),f])}const x=l(p,[["render",g],["__file","log-collection.html.vue"]]);export{x as default};
