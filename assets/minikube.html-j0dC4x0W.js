import{_ as l}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as t,o as c,c as p,a as s,f as a,b as e,e as i}from"./app-z0TS8spT.js";const r={},o=s("h2",{id:"minikube-初始化",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#minikube-初始化"},[s("span",null,"Minikube 初始化")])],-1),d=s("blockquote",null,[s("p",null,"安装")],-1),u={href:"https://minikube.sigs.k8s.io/docs/start/",target:"_blank",rel:"noopener noreferrer"},m=i(`<h3 id="启动-minikube" tabindex="-1"><a class="header-anchor" href="#启动-minikube"><span>启动 minikube</span></a></h3><blockquote><p>建议限制内存使用，本地运行，我设置的是 3g</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>minikube start <span class="token parameter variable">--memory</span> 3g
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="minikube-启用插件" tabindex="-1"><a class="header-anchor" href="#minikube-启用插件"><span>minikube 启用插件</span></a></h3><blockquote><p>启用 ingress 和 metrics (metrics是gozero默认使用的,用于自动扩展)</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>minikube addons <span class="token builtin class-name">enable</span> ingress
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="添加别名" tabindex="-1"><a class="header-anchor" href="#添加别名"><span>添加别名</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token builtin class-name">alias</span> <span class="token assign-left variable">kubectl</span><span class="token operator">=</span><span class="token string">&quot;minikube kubectl --&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="部署服务" tabindex="-1"><a class="header-anchor" href="#部署服务"><span>部署服务</span></a></h3><blockquote><p>clone 代码，进入 deploy/k8s 文件夹</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 添加服务注册发现账号</span>
kubectl apply <span class="token parameter variable">-f</span> auth.yaml

<span class="token comment"># 创建持久卷保存日志</span>
kubectl apply <span class="token parameter variable">-f</span> pv.yaml

<span class="token comment"># 修改 core-rpc.yaml 中的镜像为自己的，然后执行</span>
kubectl apply <span class="token parameter variable">-f</span> core-rpc.yaml

<span class="token comment"># 修改 core-api.yaml 中的镜像为自己的，然后执行</span>
kubectl apply <span class="token parameter variable">-f</span> core-api.yaml

<span class="token comment"># 修改 backend-ui.yaml 中的镜像为自己的，然后执行</span>
kubectl apply <span class="token parameter variable">-f</span> backend-ui.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>可以直接运行 simple-admin-core/deploy/k8s/setup.sh 完成以上操作</p></div><h3 id="ingress-配置" tabindex="-1"><a class="header-anchor" href="#ingress-配置"><span>Ingress 配置</span></a></h3>`,13),k={href:"https://minikube.sigs.k8s.io/docs/tutorials/nginx_tcp_udp_ingress/",target:"_blank",rel:"noopener noreferrer"},v=i(`<h3 id="首先创建-ingress" tabindex="-1"><a class="header-anchor" href="#首先创建-ingress"><span>首先创建 ingress</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> ingress.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>Ingress 文件</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>admin<span class="token punctuation">-</span>ingress
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">nginx.ingress.kubernetes.io/rewrite-target</span><span class="token punctuation">:</span> /$1

<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>admin.com <span class="token comment"># 域名</span>
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
            <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
            <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">service</span><span class="token punctuation">:</span>
                <span class="token key atrule">name</span><span class="token punctuation">:</span> backendui<span class="token punctuation">-</span>svc
                <span class="token key atrule">port</span><span class="token punctuation">:</span>
                  <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> simple<span class="token punctuation">-</span>admin.com <span class="token comment"># 域名</span>
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /sys<span class="token punctuation">-</span>api/
            <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
            <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">service</span><span class="token punctuation">:</span>
                <span class="token key atrule">name</span><span class="token punctuation">:</span> coreapi<span class="token punctuation">-</span>svc
                <span class="token key atrule">port</span><span class="token punctuation">:</span>
                  <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">9100</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="注册-tcp-服务到-ingress-configmap-中" tabindex="-1"><a class="header-anchor" href="#注册-tcp-服务到-ingress-configmap-中"><span>注册 tcp 服务到 ingress configmap 中</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 注册 coreapi</span>
kubectl patch configmap tcp-services <span class="token parameter variable">-n</span> ingress-nginx <span class="token parameter variable">--patch</span> <span class="token string">&#39;{&quot;data&quot;:{&quot;9100&quot;:&quot;simple-admin/coreapi-svc:9100&quot;}}&#39;</span>
<span class="token comment"># 注册 backendui, 将 8080 端口映射到backendui的80端口</span>
kubectl patch configmap tcp-services <span class="token parameter variable">-n</span> ingress-nginx <span class="token parameter variable">--patch</span> <span class="token string">&#39;{&quot;data&quot;:{&quot;8080&quot;:&quot;simple-admin/backendui-svc:80&quot;}}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="注册服务到-ingress-controller中" tabindex="-1"><a class="header-anchor" href="#注册服务到-ingress-controller中"><span>注册服务到 ingress controller中</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>kubectl patch deployment ingress-nginx-controller <span class="token parameter variable">--patch</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> ingress-patch.yaml<span class="token variable">)</span></span>&quot;</span> <span class="token parameter variable">-n</span> ingress-nginx

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>可以直接运行 simple-admin-core/deploy/k8s/setup-ingress.sh 完成以上操作</p></div><blockquote><p>查看 ingress 地址</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>kubectl get ingress
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>返回</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>NAME                   CLASS   HOSTS                               ADDRESS        PORTS   AGE
simple-admin-ingress   nginx   simple-admin.com,simple-admin.com   <span class="token number">192.168</span>.49.2   <span class="token number">80</span>      2m8s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改本地-hosts" tabindex="-1"><a class="header-anchor" href="#修改本地-hosts"><span>修改本地 hosts</span></a></h3><blockquote><p>ip 和 ingress 中一致</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 添加dns</span>
<span class="token number">192.168</span>.49.2    simple-admin.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="本地访问" tabindex="-1"><a class="header-anchor" href="#本地访问"><span>本地访问</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>http://simple-admin.com:8080/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>即可看到效果</p>`,19);function b(h,g){const n=t("ExternalLinkIcon");return c(),p("div",null,[o,d,s("p",null,[s("a",u,[a("Minikube安装"),e(n)])]),m,s("p",null,[a("参考官方文档 "),s("a",k,[a("Official Document"),e(n)])]),v])}const x=l(r,[["render",b],["__file","minikube.html.vue"]]);export{x as default};
